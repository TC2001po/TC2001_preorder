<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 관리</title>
  <style>
    .order-item {
      margin-bottom: 20px;
    }
    .completed {
      background-color: #d3ffd3; /* 완료된 주문은 초록색 배경 */
    }
  </style>
</head>
<body>
  <h1>주문 목록</h1>
  <button onclick="refreshOrders()">새로고침</button>
  <div id="orders-list"></div>

  <script>
    let previousOrdersCount = 0; // 이전 주문 개수 추적

    // 주문 목록 가져오기
    function fetchOrders() {
      fetch('/api/orders')
        .then(response => response.json())
        .then(orders => {
          const ordersList = document.getElementById('orders-list');
          ordersList.innerHTML = ''; // 기존 목록을 지우고 새로 고침

          orders.forEach(order => {
            const orderItem = document.createElement('div');
            orderItem.classList.add('order-item');
            orderItem.innerHTML = `
              <div>메뉴: ${order.menu} (${order.hotIce})</div>
              <div>옵션: ${order.options}</div>
              <div>수량: ${order.count}잔</div>
              <div>주문자: ${order.customerName}</div>
              <div>소속: ${order.customerAffiliation}</div>
              <div>픽업 시간: ${order.pickupTime}</div>
              <button onclick="completeOrder('${order.id}')">완료</button>
            `;
            
            if (order.completed) {
              orderItem.classList.add('completed'); // 완료된 주문은 배경색 변경
            }

            ordersList.appendChild(orderItem);
          });

          // 새로운 주문이 들어오면 알림음 울리기
          if (orders.length > previousOrdersCount) {
            new Audio('notification.mp3').play(); // 알림음
          }

          previousOrdersCount = orders.length; // 주문 개수 업데이트
        })
        .catch(error => console.error('주문 목록을 가져오는 중 오류가 발생했습니다:', error));
    }

    // 주문 새로 고침
    function refreshOrders() {
      fetchOrders();
    }

    // 주문 완료 처리
    function completeOrder(orderId) {
      fetch(`/api/orders/${orderId}`, { method: 'DELETE' })
        .then(response => response.json())
        .then(data => {
          alert('주문이 완료되었습니다.');
          refreshOrders(); // 새로고침
        })
        .catch(error => {
          console.error('주문 완료 처리 중 오류가 발생했습니다:', error);
        });
    }

    // 초기 주문 목록 불러오기
    fetchOrders();

    // 주문 목록을 일정 시간마다 자동으로 새로 고침
    setInterval(fetchOrders, 5000); // 5초마다 주문 목록 업데이트
  </script>
</body>
</html>
